# 事务的基本操作

### 自动提交
> MYSQL中，用户每执行一条SQL语句，默认都会当成单独的事务，自动提交。

### 手动提交
> 如果想要将一组SQL语句作为一个事务，需要在执行这组SQL之前，显式的开启事务：
```sql
START TRANSACTION;
```
- 开启事务后，后续每执行一条SQL语句将不再自动提交事务，当用户想要提交的时候，需要手动去提交。
- 只有事务提交后，事务提交语句之前的所有SQL语句才会生效。
- 手动提交事务的语句如下：
```sql
COMMIT;
```
- 如果不想提交当前事务，可以使用下列语句取消（回滚）事务，事务中的所有SQL会被撤销
- 取消事务的语句如下：
> 注意：ROLLBACK语句只能针对未提交的事务，执行回滚操作，已提交的事务是不能回滚的
```sql
ROLLBACK;
```
- 当执行完COMMIT或者ROLLBACK后，当前事务就会自动结束。

### 设置事务是否自动提交
- 由于MYSQL事务默认是自动提交的，所以用户想要设置事务的提交方式，可以通过更改AUTOCOMMIT的值来实现。
> AUTOCOMMIT = 1表示自动提交；AUTOCOMMIT = 0表示关闭自动提交；

### 查看当前会话中事务的AUTOCOMMIT值
```sql
SELECT @@AUTOCOMMIT;
```
### 关闭当前会话中事务的自动提交
> 关闭自动提交后，当执行完事务中所有的SQL语句后，用户需要手动执行提交（COMMIT）操作，事务才会提交，
> 如果直接终止MYSQL会话，事务中所有的SQL语句会自动进行撤销。
```sql
SET AUTOCOMMIT = 0;
```

### 事务的保存点（关闭自动提交的前提下）
> 在回滚事务时，事务中所有的SQL操作都将被撤销，如果只希望事务中部分的SQL操作被撤销，则可以借助事务的保存点来实现

#### 事务执行过程中创建保存点的语法如下
```sql
SAVEPOINT 保存点名;
```

#### 在事务执行过程中创建保存点后，可以将事务回滚到指定的保存点
```sql
ROLLBACK TO SAVEPOINT 保存点名;
```

#### 如果事务中某个保存点不再使用，可以通过如下语法删除
```sql
RELEASE SAVEPOINT 保存点名;
```

#### 注意点
> 1. 一个事务中可以参加多个保存点，一旦提交事务，事务中的保存点都会被删除。
> 2. 如果事务回滚到某个保存点后，该保存点之后创建的其它保存点也会被删除。

