# undo日志
- undo log称为`回滚日志`，回滚行记录到某个特定版本，用来保证事务的`原子性`和`一致性`


> undo log: 是存储引擎（innodb）生成的日志，记录的是`逻辑操作`日志，
> 比如对某一行的数据进行了`insert`语句操作。 那么`undo log`就记录一条与之相反的`delete`操作。
> 主要用于`事务的回滚`（undo log 记录的是每个修改操作的`逆操作`）和
> `一致性非锁定读`（undo log 回滚行记录到某种特定的版本-mvcc,即多版本并发控制）。
> 


### `undo log`的生命周期
- 假如有两个值，分别为A=1,B=2,然后将A修改为3，B修改为4
```markdown
1. start transaction;
2. 记录A=1到`undo log`;
3. update A = 3;
4. 记录A=3到`redo log`
5. 记录B=2到`undo log`;
6. update B = 4;
7. 记录`B=4`到`redo log`;
8. 将`redo log`刷新到磁盘;
9. commit;
```
- 再`1-8`步骤的任意一步系统宕机，事务未提交，该事务就不会对磁盘上的数据做任何影响
- 再`8-9`之间宕机，恢复之后可以选择回滚，也可以选择继续完成事务提交，因为此时`redo log`已经持久化
- 若再9之后系统宕机，内存映射中变更的数据来不及刷回磁盘，那么系统恢复之后，可以根据`redo log`把数据刷回磁盘