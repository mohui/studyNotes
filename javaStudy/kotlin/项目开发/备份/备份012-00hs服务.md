
## util中的
```markdown
package com.bjknrt.health.scheme.util

import com.bjknrt.framework.util.AppSpringUtil
import com.bjknrt.xxljob.client.rpc.model.XxlJobInfo
import com.bjknrt.xxljob.client.util.XxlJobRpcUtil
import me.danwi.kato.common.exception.KatoException

class XxlJobRpcUtil {

    companion object {
        fun pauseJob(id: Int) {
            XxlJobRpcUtil.pauseJob(id).takeIf { it }
                ?: throw KatoException(AppSpringUtil.getMessage("health-plan.job-pause-error"))
        }

        fun createJobWithFixedRate(
            author: String,
            jobDesc: String,
            delay: Long,
            executorHandler: String,
            executorParam: String,
            status: XxlJobInfo.StartStopStatusEnum
        ): Int {
            return XxlJobRpcUtil.createJobWithFixedRate(author, jobDesc, delay, executorHandler, executorParam, status)
                ?: throw KatoException(AppSpringUtil.getMessage("health-plan.create-job-error"))
        }
    }
}


```


## 单元测试,模拟
### AbstractContainerBaseTest
```markdown
package com.bjknrt.health.scheme

import com.bjknrt.framework.util.AppSpringUtil
import com.xxl.job.core.executor.XxlJobExecutor
import org.junit.jupiter.api.AfterAll
import org.springframework.boot.test.context.SpringBootTest
import org.springframework.context.annotation.Import
import org.springframework.transaction.annotation.Transactional

// https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing
// https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testing-introduction
// https://www.testcontainers.org/quickstart/junit_5_quickstart/ https://spring.io/guides/gs/testing-web/
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@Import(ConfigTest::class)
@Transactional
abstract class AbstractContainerBaseTest {
    companion object {
        @AfterAll
        @JvmStatic
        fun afterAll() {
            AppSpringUtil.getBean(XxlJobExecutor::class.java).destroy()
        }
    }
}
```
### 全删
```
package com.bjknrt.doctor.patient.management

import com.bjknrt.xxljob.client.rpc.JobGroupApi
import com.bjknrt.xxljob.client.rpc.model.XxlJobGroup
import com.xxl.job.core.biz.model.ReturnT
import org.mockito.Mockito
import org.springframework.beans.factory.InitializingBean
import org.springframework.boot.test.context.TestConfiguration
import org.springframework.boot.test.mock.mockito.MockBean
import org.springframework.boot.test.mock.mockito.MockReset

@TestConfiguration
class XxlJobTestConfig : InitializingBean {

    @MockBean(reset = MockReset.NONE)
    lateinit var jobGroupApi: JobGroupApi

    override fun afterPropertiesSet() {
        //通过服务名查询执行器的模拟
        Mockito.`when`(jobGroupApi.loadByAppName(Mockito.anyString()))
            .thenReturn(
                ReturnT(
                    XxlJobGroup().apply {
                        id = 1
                        appname = "MOCK"
                    }
                )
            )
    }


}
```

### xxlJOB模拟器
```
package com.bjknrt.health.scheme

import com.bjknrt.xxljob.client.rpc.JobGroupApi
import com.bjknrt.xxljob.client.rpc.model.XxlJobGroup
import com.xxl.job.core.biz.model.ReturnT
import org.mockito.Mockito
import org.springframework.beans.factory.InitializingBean
import org.springframework.boot.test.context.TestConfiguration
import org.springframework.boot.test.mock.mockito.MockBean
import org.springframework.boot.test.mock.mockito.MockReset

@TestConfiguration
class XxlJobTestConfig : InitializingBean {

    @MockBean(reset = MockReset.NONE)
    lateinit var jobGroupApi: JobGroupApi

    override fun afterPropertiesSet() {
        //通过服务名查询执行器的模拟
        Mockito.`when`(jobGroupApi.loadByAppName(Mockito.anyString()))
            .thenReturn(
                ReturnT(
                    XxlJobGroup().apply {
                        id = 1
                        appname = "MOCK"
                    }
                )
            )
    }

}
```