# 康宁瑞通项目流程

## 第一步: Apifor生成代码
1. 下载客户端 Apifox
> https://www.apifox.cn/
2. 团队项目, web版本
> https://www.apifox.cn/web/main
3. 打开团队项目 cloud-server
4. 新建分组 dict
5. 添加接口
> 名称: 可是中文名称, 分组: 是刚刚新建的分组, 责任人: 选择自己,
> operationId: 可用实现功能的接口名称, 如 add

6. dd
7. haha
8. 导出代码需要用客户端的才能导出
9. 在客户端 点导出 会在浏览器端出一个页面  把浏览器页面地址复制下来, 如: http://127.0.0.1:4523/export/openapi/3
10.
## 第二步
1.  找到基础架构组下生成代码项目
> https://git.bjknrt.com/newbie/arch/openapi-generator  ->
> arch(基础架构组) -> openapi-generator
- https://git.bjknrt.com/newbie/arch/openapi-generator

2. 克隆代码, 并打开, 会自动下载一大堆的依赖
> git clone  https://git.bjknrt.com/newbie/arch/openapi-generator.git

3. 打开目录
> bjknrt-server-kotlin-openapi-generator ->
> src -> test -> kotlin -> com.bjknrt.codegen
> -> BjknrtServerKotlinGeneratorTest

4. 生成项目代码

- 修改 setInputSpec("Apifor 生成代码的地址")
- 修改 setOutputDir("项目所在路径")
- 运行 launchCodeGenerator() 会自动生成代码

> 如下代码
```
fun launchCodeGenerator() {
        // to understand how the 'openapi-generator-cli' module is using 'CodegenConfigurator', have a look at the 'Generate' class:
        // https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator-cli/src/main/java/org/openapitools/codegen/cmd/Generate.java
        val configurator: CodegenConfigurator = CodegenConfigurator()
            .setGeneratorName("bjknrt-server-kotlin")
            .setInputSpec("http://127.0.0.1:4523/export/openapi/4") // or from the server
            .setOutputDir("build/out/bjknrt-server-kotlin")
            // .setGlobalProperties()
            // .addAdditionalProperty("artifactId","dict")

        val clientOptInput: ClientOptInput = configurator.toClientOptInput()
        val generator = BjknrtGenerator()
        generator.opts(clientOptInput)
            .generate()
    }
```

5. 注释代码
> 注释根目录下 settings.gradle.kts 文件的 外网代码(如下), 刷新
```
// 注释掉的代码
maven(getMavenArtifactRepo("http://repo.gate.bjknrt.com/repository/gradle-plugin/", "maven-bjknrt-plugin-web"))
```

6. AppConfig 报错原因 是 sqlEx默认生成后刷新一下就好了
7. 改自己的数据库名和账号密码
> src -> main ->resources ->....-local.yml

8. 



在main 下 创建 sqlex 目录





到了些接口阶段
些日志  log.debug("添加字典日志{}")

## 应用篇
1. XXXserver -> src -> main -> resource -> 右击 -> New -> Resource Bundle
```messages.properties
mrs.no-find-data=未查询到数据.
```
```引用
AppSpringUtil.getMessage("mrs.no-find-data")
```
2. update,delete,insert 接口 添加注解
```markdown
@Transactional(rollbackFor = [Exception::class])
```
3. sqlex-> com.bjknrt.xxx 目录下和 migration同级建立复杂sql模板
```sql
list() {
    select *
    from mr_medication_remind
}
```
```
 class MedicationRemindController(
 val dao:MrMedicationRemindDao
 ) : AppBaseController(), MedicationRemindApi {
 }

```
## 规范
开发 公用sql规范
```sql
create table demo_common
(
    kn_id         bigint unsigned not null primary key comment '唯一主键',
    kn_created_by bigint unsigned null comment '创建人id',
    kn_created_at datetime(3)     not null default current_timestamp(3) comment '创建时间',
    kn_updated_by bigint unsigned null comment '修改人id',
    kn_updated_at datetime(3)     not null default current_timestamp(3) on update current_timestamp(3) comment '修改时间'
)
```